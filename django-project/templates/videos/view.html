{% extends "course_base.html" %}
{% load url from future %}
{% block l_column_content %}
<!-- <div id="c2g_layout_l_column" class="span3">
    <div class="well tight">
        <ul class="nav nav-list">
            <li class="nav-header">Videos</li>
            <li class="active"><a href="#">1.1 Course Intro</a></li>
            <li><a href="#">1.2 History of Field</a></li>
            <li><a href="#">1.3 Big Issues</a></li>
            <li><a href="#">1.4 Another nav item</a></li>
            <li><a href="#">1.5 Another nav item</a></li>
            <li class="divider"></li>
            <li><a href="#"><i class="icon-flag"></i>Help</a></li>
            <li><a href="#"><i class="icon-envelope-alt"></i>Contact</a></li>
        </ul>
    </div>
</div> -->
{% endblock %}

{% block m_column_content %}
<link rel="stylesheet" href="{{ STATIC_URL}}latestKhan/demo/css/quiz_iframe.css" />
<div id="c2g_layout_m_column" class="span9">
  {% if user.is_authenticated %}
    {% if common_page_data.is_course_admin %}
      <a href="{% url 'courses.videos.views.edit' common_page_data.course_prefix common_page_data.course_suffix video.slug %}" class="btn">Edit Video</a>
    {% endif %}
    {% if video.title == 'Defining Minimum Edit Distance' %}
        <iframe width="900" height="700" src="{{STATIC_URL}}latestKhan/demo/nlp_with_khan_multi2.html" frameborder="0" scrolling="no" allowfullscreen></iframe>
    {% elif video.title == "Regular Expressions" or video.title == "Word Tokenization" %}
        <h2 class="section-headline">{{video.title}}</h2>
        <div class="content">
          <div class="quizModule">
            <div id="qInst"></div>
            <div id="playerdiv">
              <div id="player"></div>
              <div id="slideIndex"></div>
            </div>
          </div>
        </div>
    {% else %}
        <h2>{{video.title}}</h2>
        <!-- iframe width="710" height="430" src="https://www.youtube.com/embed/{{video.url}}?rel=0" frameborder="0" allowfullscreen></iframe -->
    <div id="player"></div>
    {% endif %}
  {% else %}
    <h4>Please log in to see videos.</h4>
  {% endif %}
</div>


{% endblock m_column_content %}

{% block addl_scripts %}

{% if video.title == "Regular Expressions" or video.title == "Word Tokenization" %}
<script src="{{ STATIC_URL }}/js/thumbnails.js" /></script>
<script>
    var path = '/static/graphics/videos/nlp/' + encodeURIComponent("{{ video.title }}") + '/jpegs/';
    var tmpmanifest = {};
    var loadTmpmanifest = function (data, textStatus, jqXHR) { 
        $.each(data, function (key, val) {
            $.each(val, function (k, v) {
                if (k == "imgsrc") {
                    val[k] = path + v;
                }
            })
            tmpmanifest[parseInt(key)] = val; 
        });
    };
    $.getJSON(path + "manifest.txt", "", loadTmpmanifest);
    var thumbSet = initThumbnails('{{ video.url }}', tmpmanifest, {});
</script>
{% else %}
<script type="text/javascript">
  // This code loads the IFrame Player API code asynchronously.
  var tag = document.createElement('script');
  tag.src = "//www.youtube.com/player_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  // This function creates a YouTube player after the API code downloads.
  var player;
  function onYouTubePlayerAPIReady() {
    player = new YT.Player('player', {
      height: '430',
      width: '710',
      videoId: '{{video.url}}',
        /* [@wescott] commented out below for Kevin for the 8/1/12 demo */
      /*playerVars: { 'rel': 0, 'start': {{video_rec.start_seconds}} },*/
      playerVars: { 'rel': 0, 'start': 0 },
    });
  }

  window.onbeforeunload = function() {
    vidTime = Math.floor(player.getCurrentTime());
    /* [@wescott] commented out below for Kevin for the 8/1/12 demo */
    /*$.ajax({type:"POST", url: "/videos/save/", async:false, data: {videoRec: {{video_rec.id}}, playTime: vidTime, csrfmiddlewaretoken: '{{ csrf_token }}'}});*/
    $.ajax({type:"POST", url: "/videos/save/", async:false, data: {videoRec: 1, playTime: vidTime, csrfmiddlewaretoken: '{{ csrf_token }}'}});
  }
</script>
{% endif %}

{% endblock addl_scripts %}
